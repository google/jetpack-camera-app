#!/bin/sh

echo "Running Spotless check before push..."

# Run the spotlessCheck command.
# If it fails, it will exit with a non-zero status code,
# which will automatically cause the pre-push hook to fail and abort the push.
./gradlew spotlessCheck --init-script gradle/init.gradle.kts

# Capture the exit code of the last command
EXIT_CODE=$?

# Check if the command failed
if [ $EXIT_CODE -ne 0 ]; then
    echo "--------------------------------------------------"
    echo "ERROR: Spotless check failed."
    echo "Your code is not formatted correctly."
    echo ""
    echo "Please run the following command to fix it:"
    echo "  ./gradlew spotlessApply --init-script gradle/init.gradle.kts"
    echo ""
    echo "Then, stage the changes and amend your commit before pushing."
    echo "--------------------------------------------------"
    # Exit with a non-zero status to abort the push
    exit 1
fi

echo "Spotless check passed. Proceeding with push."
exit 0
